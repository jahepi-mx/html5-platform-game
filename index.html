<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="engine/config/config.js"></script>
        <script src="engine/levels/level1.js"></script>
        <script src="engine/entities/tile.js"></script>
        <script src="engine/entities/hero.js"></script>
        <script src="engine/entities/heroblast.js"></script>
        <script src="engine/entities/blockenemy.js"></script>
        <script src="engine/entities/lavaenemy.js"></script>
        <script src="engine/entities/stingenemy.js"></script>
        <script src="engine/entities/giantfatenemy.js"></script>
        <script src="engine/entities/enemyblast.js"></script>
        <script src="engine/resources/assets.js"></script>
        <script src="engine/resources/atlas.js"></script>
        <script src="engine/camera.js"></script>
        <script src="engine/render.js"></script>
        <script src="engine/controller.js"></script>
        <script src="engine/animation.js"></script>
        <script src="engine/scenes/gamescene.js"></script>
        <script src="engine/scenes/mainscene.js"></script>
        <style type="text/css">
            #game {
                width: 100%;
                height: 100%;
              }
             #gameDiv {
                position: absolute;
                left: 50%;
                top: 50%;
              }
        </style>
        <script>
            var scene;
            var context;
            var canvas;
            var prevTimestamp = 0;
            
            window.onload = function() {
                window.addEventListener('resize', resizeGame, false);
                window.addEventListener('orientationchange', resizeGame, false);
                resizeGame();
                canvas = document.getElementById("game");
                context = canvas.getContext("2d");
                canvas.width = Config.worldWidth;
                canvas.height = Config.worldHeight;
                scene = new MainScene(context, canvas, changeSceneCallback);
                window.requestAnimationFrame(onUpdate);    
            };
            
            function onUpdate(timestamp) {
                var deltatime = (timestamp - prevTimestamp) / 1000;
                scene.update(deltatime);
                prevTimestamp = timestamp;
                window.requestAnimationFrame(onUpdate);
            }
            
            function changeSceneCallback(sceneName) {
                if (sceneName === "main") {
                    scene = new MainScene(context, canvas, changeSceneCallback);
                } else if (sceneName === "game") {
                    scene = new GameScene(context, canvas, changeSceneCallback);
                }
            }
            
            function resizeGame() {
                var gameArea = document.getElementById('gameDiv');
                var widthToHeight = Config.worldWidth / Config.worldHeight;
                var newWidth = window.innerWidth;
                var newHeight = window.innerHeight;
                var newWidthToHeight = newWidth / newHeight;

                if (newWidthToHeight > widthToHeight) {
                    newWidth = newHeight * widthToHeight;
                    gameArea.style.height = newHeight + 'px';
                    gameArea.style.width = newWidth + 'px';
                } else {
                    newHeight = newWidth / widthToHeight;
                    gameArea.style.width = newWidth + 'px';
                    gameArea.style.height = newHeight + 'px';
                }

                gameArea.style.marginTop = (-newHeight / 2) + 'px';
                gameArea.style.marginLeft = (-newWidth / 2) + 'px';

                var gameCanvas = document.getElementById('game');
                gameCanvas.width = newWidth;
                gameCanvas.height = newHeight;
            }
        </script>
    </head>
    <body style="background-color: black">
        <div id="gameDiv">
            <canvas id="game" style="background-color: black;"></canvas>
        </div>
    </body>
</html>
